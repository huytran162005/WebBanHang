@model WebBanHang.Areas.Customer.Models.ProductCategoryPageVM

<div class="row">
    <!-- CATEGORY LIST -->
    <div class="col-md-3">
        <div class="list-group mb-4" id="category-list">
            <a href="#" class="list-group-item list-group-item-action active" data-category-id="0">
                Tất cả
                <span class="badge bg-secondary rounded-pill float-end">@Model.Categories.Sum(c => c.ProductCount)</span>
            </a>
            @foreach (var cat in Model.Categories)
            {
                <a href="#" class="list-group-item list-group-item-action" data-category-id="@cat.Id">
                    @cat.Name
                    <span class="badge bg-primary rounded-pill float-end">@cat.ProductCount</span>
                </a>
            }
        </div>
    </div>

    <!-- PRODUCT LIST -->
    <div class="col-md-9">
        <div class="row row-cols-1 row-cols-md-3 g-4" id="product-list">
            @foreach (var p in Model.Products)
            {
                <div class="col product-item">
                    <div class="card h-100 shadow-sm">
                        <h6 class="card-header text-center">@p.Name</h6>
                        @if (string.IsNullOrEmpty(p.ImageUrl))
                        {
                            <svg xmlns="http://www.w3.org/2000/svg" class="d-block user-select-none" width="100%" height="200" aria-label="Placeholder: Image cap" focusable="false" role="img" preserveAspectRatio="xMidYMid slice" viewBox="0 0 318 180" style="font-size:1.125rem;text-anchor:middle">
                                <rect width="100%" height="100%" fill="#868e96"></rect>
                                <text x="50%" y="50%" fill="#dee2e6" dy=".3em">Image cap</text>
                            </svg>
                        }
                        else
                        {
                            <img src="/@p.ImageUrl" class="card-img-top" style="height: 200px; object-fit: contain;" alt="@p.Name">
                        }
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item fw-bold">Price: $ @p.Price</li>
                        </ul>
                        <div class="card-body d-flex justify-content-between">
                            <a href="#" class="btn btn-outline-primary btn-sm">Detail</a>
                            <a href="#" class="btn btn-outline-success btn-sm">Add To Cart</a>
                        </div>
                        <div class="card-footer text-muted small text-center">
                            Danh mục: @p.Category?.Name
                        </div>
                    </div>
                </div>
            }
        </div>
        <div id="no-products-message" class="alert alert-warning mt-4" style="display: none;">
            Không có sản phẩm nào.
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Khi người dùng click vào danh mục
            $('#category-list a').click(function (e) {
                e.preventDefault();

                // Xóa class 'active' khỏi tất cả danh mục và thêm vào danh mục được chọn
                $('#category-list a').removeClass('active');
                $(this).addClass('active');

                // Lấy categoryId từ thuộc tính data-category-id
                var categoryId = $(this).data('category-id');

                // Gọi API để lấy danh sách sản phẩm
                $.ajax({
                    url: '@Url.Action("GetProductsByCategory", "Product", new { area = "Customer" })',
                    type: 'GET',
                    data: { categoryId: categoryId },
                    success: function (data) {
                        // Xóa danh sách sản phẩm cũ
                        $('#product-list').empty();

                        if (data.length > 0) {
                            // Render danh sách sản phẩm mới
                            $.each(data, function (i, product) {
                                var productHtml = `
                                    <div class="col product-item">
                                        <div class="card h-100 shadow-sm">
                                            <h6 class="card-header text-center">${product.name}</h6>
                                            ${product.imageUrl ? `
                                                <img src="/${product.imageUrl}" class="card-img-top" style="height: 200px; object-fit: contain;" alt="${product.name}">
                                            ` : `
                                                <svg xmlns="http://www.w3.org/2000/svg" class="d-block user-select-none" width="100%" height="200" aria-label="Placeholder: Image cap" focusable="false" role="img" preserveAspectRatio="xMidYMid slice" viewBox="0 0 318 180" style="font-size:1.125rem;text-anchor:middle">
                                                    <rect width="100%" height="100%" fill="#868e96"></rect>
                                                    <text x="50%" y="50%" fill="#dee2e6" dy=".3em">Image cap</text>
                                                </svg>
                                            `}
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item fw-bold">Price: $ ${product.price}</li>
                                            </ul>
                                            <div class="card-body d-flex justify-content-between">
                                                <a href="#" class="btn btn-outline-primary btn-sm">Detail</a>
                                                <a href="#" class="btn btn-outline-success btn-sm">Add To Cart</a>
                                            </div>
                                            <div class="card-footer text-muted small text-center">
                                                Danh mục: ${product.categoryName}
                                            </div>
                                        </div>
                                    </div>
                                `;
                                $('#product-list').append(productHtml);
                            });

                            // Ẩn thông báo không có sản phẩm
                            $('#no-products-message').hide();
                        } else {
                            // Hiển thị thông báo không có sản phẩm
                            $('#no-products-message').show();
                        }
                    },
                    error: function () {
                        alert('Đã xảy ra lỗi khi tải sản phẩm!');
                    }
                });
            });
        });
    </script>
}